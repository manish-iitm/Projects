<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link rel="icon" href="https://i.ibb.co/JwpV7g6B/code-4997543.png" type="image/jpeg">
   <link rel="shortcut icon" href="https://i.ibb.co/JwpV7g6B/code-4997543.png" type="image/jpeg">
   <title>Home</title>
   <style>
      /*=============== GOOGLE FONTS ===============*/
      @import url("https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;600;700&display=swap");

      /*=============== VARIABLES CSS ===============*/
      :root {
         /*========== Colors ==========*/
         --first-color: hsl(225, 95%, 56%);
         --black-color: hsl(225, 12%, 12%);
         --white-color: hsl(0, 0%, 100%);
         --text-color: hsl(225, 8%, 65%);
         --body-color: hsl(225, 100%, 99%);
         --primary-blue: #1E88E5;
         --primary-blue-dark: #1565C0;
         --vibrant-orange: #FF6F00;
         --vibrant-orange-dark: #E65100;
         --card-bg: #ffffff;
         --text-secondary: #666666;
         --text-primary: #333333;
         --success-green: #4CAF50;
         --error-red: #F44336;
         --border-color: #e0e0e0;

         /*========== Font and typography ==========*/
         --body-font: "Montserrat Alternates", sans-serif;
         --biggest-font-size: 2.5rem;
         --tiny-font-size: .625rem;

         /*========== Font weight ==========*/
         --font-regular: 400;
         --font-semi-bold: 600;
         --font-bold: 700;

         /*========== z index ==========*/
         --z-tooltip: 10;
         --z-fixed: 100;
      }

      /* Dark mode variables */
      html.dark-mode {
         --black-color: hsl(0, 0%, 95%); /* Becomes white */
         --white-color: hsl(225, 12%, 12%); /* Becomes black */
         --text-color: hsl(225, 8%, 75%);
         --body-color: hsl(225, 12%, 18%);
         --card-bg: hsl(225, 12%, 15%);
         --text-secondary: hsl(225, 8%, 65%);
         --text-primary: hsl(0, 0%, 90%);
         --border-color: hsl(225, 12%, 25%);

         /* Blue becomes orange in dark mode */
         --primary-blue: var(--vibrant-orange);
         --primary-blue-dark: var(--vibrant-orange-dark);
         --first-color: var(--vibrant-orange);
      }

      /*========== Responsive typography ==========*/
      @media screen and (min-width: 1150px) {
         :root {
            --biggest-font-size: 3.5rem;
         }
      }

      /*=============== BASE ===============*/
      * {
         box-sizing: border-box;
         padding: 0;
         margin: 0;
      }

      html {
         scroll-behavior: smooth;
      }

      body {
         font-family: var(--body-font);
         background-color: var(--body-color);
         color: var(--text-color);
         transition: background-color 0.3s, color 0.3s;
      }

      ul {
         list-style: none;
      }

      a {
         text-decoration: none;
      }

      /*=============== REUSABLE CSS CLASSES ===============*/
      .container {
         max-width: 1120px;
         margin-inline: 1.5rem;
      }

      .section {
         min-height: calc(100vh - 8rem); 
         padding: 2.5rem 0;
         display: none; 
      }
      
      .section.active {
         display: block; 
      }

      .section h1 {
         font-size: var(--biggest-font-size);
         color: var(--black-color);
         text-align: center;
         margin-bottom: 1.5rem;
      }

      /*=============== NAVBAR ===============*/
      .nav {
         position: fixed;
         bottom: 1.5rem;
         left: 0;
         right: 0;
         background-color: var(--white-color);
         color: var(--black-color);
         width: 90%;
         max-width: 500px;
         margin: 0 auto;
         box-shadow: 0 2px 16px hsla(228, 95%, 4%, .1);
         padding: 1rem 1.75rem;
         border-radius: 4rem;
         z-index: var(--z-fixed);
      }

      .nav__list {
         display: flex;
         justify-content: space-between;
         align-items: center;
      }

      .nav__link {
         color: var(--text-color);
         font-size: 1.5rem;
         transition: color .4s;
      }

      .nav__link:hover {
         color: var(--black-color);
      }

      /*=============== EXPAND LIST ===============*/
      .nav__expand {
         border: none;
         outline: none;
         width: 40px;
         height: 40px;
         background-color: var(--first-color);
         border-radius: 50%;
         cursor: pointer;
      }

      .nav__expand-icon {
         display: inline-block;
         color: var(--white-color);
         font-size: 1.5rem;
         transition: transform .4s;
      }

      .nav__expand-list {
         position: absolute;
         bottom: calc(100% + 1rem);
         left: 50%;
         transform: translateX(-50%);
         background-color: var(--white-color);
         box-shadow: 0 2px 16px hsla(228, 95%, 4%, .1);
         width: max-content;
         padding: .5rem 1.5rem;
         border-radius: 4rem;
         display: flex;
         justify-content: center;
         column-gap: 2rem;
         z-index: -1;
         visibility: hidden;
         opacity: 0;
         transform: translateY(1rem) scale(.9) translateX(-50%);
         transition: transform .3s, opacity .3s, visibility .3s;
      }

      .nav__expand-list li {
          transition: transform .3s;
      }

      .nav__expand-link {
         color: var(--text-color);
         display: flex;
         flex-direction: column;
         align-items: center;
         transition: color .4s;
      }

      .nav__expand-link i {
         font-size: 1.5rem;
      }

      .nav__expand-link span {
         font-size: var(--tiny-font-size);
         font-weight: var(--font-semi-bold);
      }

      .nav__expand-link:hover {
         color: var(--black-color);
      }

      .show-list {
         visibility: visible;
         opacity: 1;
         transform: translateY(0) scale(1) translateX(-50%);
         z-index: var(--z-fixed);
      }

      .rotate-icon {
         transform: rotate(135deg);
      }

      .active-link {
         color: var(--first-color);
      }

      /*=============== THEME TOGGLE (IN MENU) ===============*/
      .theme-toggle-menu {
         background: none;
         border: none;
         outline: none;
      }

      .theme-toggle-menu .moon-icon { display: none; }
      .theme-toggle-menu .sun-icon { display: block; }
      html.dark-mode .theme-toggle-menu .moon-icon { display: block; }
      html.dark-mode .theme-toggle-menu .sun-icon { display: none; }
      
      /*=============== SETTINGS PAGE ===============*/
      .settings-container {
         max-width: 600px;
         margin: 2rem auto;
         padding: 2rem;
         background-color: var(--card-bg);
         border-radius: 12px;
         border: 1px solid var(--border-color);
      }

      .setting-item {
         display: flex;
         justify-content: space-between;
         align-items: center;
         padding: 1rem 0;
         border-bottom: 1px solid var(--border-color);
      }
      .setting-item:last-child {
         border-bottom: none;
      }

      .setting-label {
         font-size: 1.1rem;
         font-weight: var(--font-semi-bold);
         color: var(--text-primary);
      }

      .theme-switch {
         position: relative;
         display: inline-block;
         width: 60px;
         height: 34px;
      }

      .theme-switch input {
         opacity: 0;
         width: 0;
         height: 0;
      }

      .slider {
         position: absolute;
         cursor: pointer;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: #ccc;
         transition: .4s;
         border-radius: 34px;
      }

      .slider:before {
         position: absolute;
         content: "";
         height: 26px;
         width: 26px;
         left: 4px;
         bottom: 4px;
         background-color: white;
         transition: .4s;
         border-radius: 50%;
      }

      input:checked + .slider {
         background-color: var(--primary-blue);
      }

      input:focus + .slider {
         box-shadow: 0 0 1px var(--primary-blue);
      }

      input:checked + .slider:before {
         transform: translateX(26px);
      }

      /*=============== IFRAME CONTAINER ===============*/
      .iframe-container {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: var(--body-color);
         z-index: 1000;
         display: none;
         flex-direction: column;
      }

      .iframe-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         padding: 1rem;
         background-color: var(--card-bg);
         border-bottom: 1px solid var(--border-color);
      }

      .iframe-title {
         font-family: var(--body-font);
         color: var(--text-primary);
         font-weight: var(--font-semi-bold);
      }

      .iframe-close {
         background: none;
         border: none;
         color: var(--text-primary);
         font-size: 1.5rem;
         cursor: pointer;
      }

      .iframe-content {
         flex: 1;
         width: 100%;
         border: none;
      }

      /*=============== INTERACTIVE STORIES ===============*/
      .stories-container {
         display: flex;
         background-color: var(--card-bg);
         font-family: var(--body-font);
         box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
         border: 1px solid var(--border-color);
         max-width: 1200px;
         margin: 0 auto;
         padding: 20px 36px;
         border-radius: 12px;
         gap: 24px;
         overflow-x: auto;
         box-sizing: border-box;
      }

      .stories-container::-webkit-scrollbar { height: 8px; }
      .stories-container::-webkit-scrollbar-track { background: transparent; }
      .stories-container::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
      html.dark-mode .stories-container::-webkit-scrollbar-thumb { background: #555; }
      .stories-container::-webkit-scrollbar-thumb:hover { background: #999; }
      html.dark-mode .stories-container::-webkit-scrollbar-thumb:hover { background: #777; }

      .story-item { display: flex; flex-direction: column; align-items: center; gap: 8px; min-width: 100px; }
      .story-item .content { position: relative; cursor: pointer; }
      .story-item .content img { height: 90px; width: 90px; border-radius: 50%; object-fit: cover; z-index: 3; position: relative; vertical-align: middle; }
      .story-item .content::before { content: ""; height: 98px; width: 98px; background: var(--card-bg); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2; }
      .story-item .content::after { content: ""; height: 106px; width: 106px; background: linear-gradient(#dd2a7b, #f58529); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1; transition: opacity 0.3s ease; }
      .story-item.viewed .content::after { opacity: 0; }
      .story-title { font-size: 14px; font-weight: 500; text-align: center; max-width: 100px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-primary); }

      .story-full { background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); position: fixed; left: 0; top: 0; height: 100%; width: 100%; z-index: 500; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 300ms ease; }
      .story-full.active { opacity: 1; pointer-events: auto; }
      .story-full .close-btn { position: fixed; right: 32px; top: 32px; width: 32px; cursor: pointer; }
      .story-full .content .left-arrow, .story-full .content .right-arrow { width: 60px; cursor: pointer; }
      .story-full .content { height: 100%; display: flex; align-items: center; position: relative; }
      .story-full img { height: 90%; max-width: 90%; object-fit: contain; }
      .story-full .content .title { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(30, 30, 30, 0.9); color: white; padding: 8px 32px; border-radius: 20px; text-align: center; }
      .learn-more-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: #dd2a7b; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; text-decoration: none; display: inline-block; }
      .learn-more-btn:hover { background: #f58529; }

      /*=============== SIMPLIFIED INSTAGRAM POSTS ===============*/
      .instagram-posts-container { max-width: 600px; margin: 30px auto 0; font-family: var(--body-font); }
      .instagram-post { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 24px; overflow: hidden; }
      .post-image { width: 100%; max-height: 600px; object-fit: cover; cursor: pointer; }
      .post-title { padding: 12px 16px; font-size: 14px; color: var(--text-primary); text-align: center; border-top: 1px solid var(--border-color); }
      .loading-posts { text-align: center; padding: 40px; font-size: 14px; color: var(--text-secondary); }
      .post-error { color: var(--error-red); text-align: center; padding: 40px; }

      /*=============== PROJECTS SECTION ===============*/
      .projects-container { font-family: var(--body-font); background-color: var(--card-bg); color: var(--text-primary); padding: 2rem; border-radius: 12px; max-width: 1200px; margin: 0 auto; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); border: 1px solid var(--border-color); }
      .header-container { width: 100%; margin-bottom: 40px; text-align: center; animation: fadeIn 1s ease-out; }
      .header-container h2 { font-size: 1.8rem; color: var(--primary-blue); margin-bottom: 10px; font-weight: 700; }
      .header-container p { font-size: 1rem; color: var(--text-secondary); margin-bottom: 25px; max-width: 700px; margin-left: auto; margin-right: auto; }
      .search-container { position: relative; width: 100%; max-width: 500px; margin: 0 auto; }
      #projectSearchBar { width: 100%; padding: 12px 20px 12px 45px; font-size: 1rem; border: 2px solid var(--primary-blue); border-radius: 25px; background-color: var(--body-color); color: var(--text-primary); outline: none; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(30, 136, 229, 0.1); }
      #projectSearchBar:focus { border-color: var(--vibrant-orange); box-shadow: 0 0 10px hsla(var(--primary-blue), 0.2); }
      .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; }
      #projectGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; width: 100%; }
      .project-card { background-color: var(--card-bg); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; border: 1px solid var(--border-color); position: relative; height: 100%; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
      .project-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px hsla(var(--primary-blue), 0.1), 0 0 15px hsla(var(--vibrant-orange), 0.1); border-color: var(--primary-blue); }
      .project-card:focus-within { outline: 2px solid var(--vibrant-orange); outline-offset: 2px; }
      .project-card .project-icon-container { width: 100px; height: 100px; margin-bottom: 15px; border-radius: 8px; overflow: hidden; background-color: #f5f5f5; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
      .project-card:hover .project-icon-container { background-color: var(--primary-blue); }
      .project-card .project-icon { width: 100%; height: 100%; object-fit: contain; transition: transform 0.3s ease; }
      .project-card:hover .project-icon { transform: scale(1.1); }
      .project-card .project-name { font-size: 1.2rem; font-weight: 600; color: var(--text-primary); margin-bottom: 5px; word-break: break-word; flex-grow: 1; display: flex; align-items: center; }
      .project-card .project-link { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; text-indent: -9999px; }
      .loading-spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid hsla(var(--primary-blue), 0.2); border-radius: 50%; border-top-color: var(--primary-blue); animation: spin 1s ease-in-out infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
      #projectMessage { color: var(--text-secondary); font-size: 1.1rem; margin-top: 20px; text-align: center; width: 100%; min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; }
      .message-icon { font-size: 2rem; color: var(--primary-blue); }

      /*=============== CONTACT FORM ===============*/
      .contact-container { font-family: var(--body-font); background-color: var(--card-bg); color: var(--text-primary); padding: 2rem; border-radius: 12px; max-width: 700px; margin: 0 auto; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); border: 1px solid var(--border-color); }
      .contact-container .form-group { margin-bottom: 1.5rem; }
      .contact-container label { display: block; margin-bottom: .5rem; font-weight: var(--font-semi-bold); color: var(--text-primary); }
      .contact-container input, .contact-container textarea { width: 100%; padding: 12px 15px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; font-family: var(--body-font); background-color: var(--body-color); color: var(--text-primary); transition: border-color .3s, box-shadow .3s; }
      .contact-container input:focus, .contact-container textarea:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 5px hsla(var(--primary-blue), 0.2); }
      .contact-container textarea { height: 150px; resize: vertical; }
      .contact-container button { background-color: var(--primary-blue); color: var(--white-color); border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: var(--font-semi-bold); transition: background-color .3s; width: 100%; font-family: var(--body-font); }
      .contact-container button:hover { background-color: var(--primary-blue-dark); }
      #form-status { margin-top: 1.5rem; padding: 10px; border-radius: 8px; display: none; text-align: center; font-family: var(--body-font); }
      #form-status.success { background: hsl(145, 63%, 90%); color: hsl(145, 63%, 20%); border: 1px solid hsl(145, 63%, 70%); }
      #form-status.error { background: hsl(0, 84%, 90%); color: hsl(0, 84%, 30%); border: 1px solid hsl(0, 84%, 70%); }

      /*=============== BREAKPOINTS ===============*/
      @media screen and (min-width: 450px) { .nav { width: 350px; } }
      @media screen and (min-width: 1150px) { .container { margin-inline: auto; } }
      @media (max-width: 768px) { #projectGrid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; } .project-card { padding: 15px; } .project-card .project-icon-container { width: 80px; height: 80px; } .project-card .project-name { font-size: 1.1rem; } }
      @media (max-width: 700px) { .stories-container { width: 90%; gap: 16px; padding: 15px 20px; } .story-item .content img { width: 60px; height: 60px; } .story-item .content::before { height: 70px; width: 70px; } .story-item .content::after { width: 80px; height: 80px; } .story-title { font-size: 12px; max-width: 80px; } .story-full .content img { height: 65%; } }
      @media (max-width: 480px) { .projects-container, .contact-container, .settings-container { padding: 1rem; } #projectGrid { grid-template-columns: 1fr; gap: 15px; } .project-card .project-icon-container { width: 70px; height: 70px; } .project-card .project-name { font-size: 1rem; } }
   </style>
   <script>
      // Apply theme immediately to prevent flash of wrong theme
      (function() {
         const theme = localStorage.getItem('theme') || 'light'; 
         if (theme === 'dark') {
            document.documentElement.classList.add('dark-mode');
         }
      })();
   </script>
</head>
<body>
   <!--=============== NAVBAR ===============-->
   <nav class="nav">
      <ul class="nav__list">
         <li><a href="#home" class="nav__link active-link"><i class="ri-home-smile-2-line"></i></a></li>
         <li><a href="#projects" class="nav__link"><i class="ri-briefcase-line"></i></a></li>
         <li>
            <button class="nav__expand" id="nav-expand">
               <i class="ri-add-line nav__expand-icon" id="nav-expand-icon"></i>
            </button>
            <ul class="nav__expand-list" id="nav-expand-list">
               <li><a href="#" class="nav__expand-link" data-url="https://mpgamescr.netlify.app"><i class="ri-gamepad-line"></i><span>Games</span></a></li>
               <li><a href="#" class="nav__expand-link" data-url="https://procr.netlify.app/edufloow"><i class="ri-book-line"></i><span>EduFloow</span></a></li>
               <li><a href="#" class="nav__expand-link" data-url="https://procrblog.blogspot.com"><i class="ri-article-line"></i><span>Blogs</span></a></li>
            </ul>
         </li>
         <li><a href="#contact" class="nav__link"><i class="ri-send-plane-line"></i></a></li>
         <li><a href="#settings" class="nav__link"><i class="ri-settings-3-line"></i></a></li>
      </ul>
   </nav>

   <!--=============== IFRAME CONTAINER ===============-->
   <div class="iframe-container" id="iframe-container">
      <div class="iframe-header">
         <div class="iframe-title" id="iframe-title">Loading...</div>
         <button class="iframe-close" id="iframe-close"><i class="ri-close-line"></i></button>
      </div>
      <iframe class="iframe-content" id="iframe-content" frameborder="0"></iframe>
   </div>

   <!--==================== MAIN ====================-->
   <main class="container">
      <section class="section active" id="home">
         <h1>HOME</h1>
         <div class="stories-container"></div>
         <div class="story-full">
           <div class="content">
             <div class="close-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="#fff" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></div>
             <div class="left-arrow"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="#fff" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg></div>
             <img src="" alt="Story Image">
             <div class="right-arrow"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="#fff" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg></div>
             <div class="title">Story Title</div>
             <a href="#" class="learn-more-btn" target="_blank">Learn More</a>
           </div>
         </div>
         <div class="instagram-posts-container" id="instagram-posts"><div class="loading-posts">Loading posts...</div></div>
      </section>

      <section class="section" id="projects">
         <h1>PROJECTS</h1>
         <div class="projects-container">
            <div class="header-container">
               <div class="search-container">
                  <i class="fas fa-search search-icon"></i>
                  <input type="search" id="projectSearchBar" placeholder="Search projects by name..." aria-label="Search projects">
               </div>
            </div>
            <div id="projectGrid"></div>
            <div id="projectMessage"><div class="loading-spinner"></div><p>Loading projects...</p></div>
         </div>
      </section>

      <section class="section" id="contact">
         <h1>CONTACT</h1>
         <div class="contact-container">
            <form id="contact-form">
               <div class="form-group"><label for="name">Your Name:</label><input type="text" id="name" name="name" required></div>
               <div class="form-group"><label for="email">Your Email:</label><input type="email" id="email" name="email" required></div>
               <div class="form-group"><label for="subject">Subject:</label><input type="text" id="subject" name="subject" required></div>
               <div class="form-group"><label for="message">Message:</label><textarea id="message" name="message" required></textarea></div>
               <button type="submit">Send Message</button>
               <div id="form-status"></div>
            </form>
         </div>
      </section>

      <section class="section" id="settings">
         <h1>SETTINGS</h1>
         <div class="settings-container">
            <div class="setting-item">
               <span class="setting-label">Dark Mode</span>
               <label class="theme-switch">
                  <input type="checkbox" id="theme-switch-toggle">
                  <span class="slider"></span>
               </label>
            </div>
         </div>
      </section>
   </main>
   
   <script>
      document.addEventListener('DOMContentLoaded', () => {

         /*=============== THEME & UI SYNCHRONIZATION ===============*/
         const themeSwitch = document.getElementById('theme-switch-toggle');
         const htmlEl = document.documentElement;

         // Function to set the theme and update all UI elements
         function applyTheme(theme) {
            if (theme === 'dark') {
               htmlEl.classList.add('dark-mode');
               themeSwitch.checked = true;
            } else {
               htmlEl.classList.remove('dark-mode');
               themeSwitch.checked = false;
            }
            localStorage.setItem('theme', theme);
         }

         // Listener for the main toggle on the Settings page
         themeSwitch.addEventListener('change', () => {
            const newTheme = themeSwitch.checked ? 'dark' : 'light';
            applyTheme(newTheme);
         });

         // Initialize theme on page load
         const initialTheme = localStorage.getItem('theme') || 'light';
         applyTheme(initialTheme);
         
         /*=============== EXPANDABLE MENU LOGIC ===============*/
         const navExpandBtn = document.getElementById('nav-expand');
         const navExpandList = document.getElementById('nav-expand-list');
         const navExpandIcon = document.getElementById('nav-expand-icon');

         navExpandBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            navExpandList.classList.toggle('show-list');
            navExpandIcon.classList.toggle('rotate-icon');
         });

         document.addEventListener('click', () => {
            if (navExpandList.classList.contains('show-list')) {
               navExpandList.classList.remove('show-list');
               navExpandIcon.classList.remove('rotate-icon');
            }
         });
         
         /*=============== PAGE NAVIGATION LOGIC ===============*/
         const navLinks = document.querySelectorAll('.nav__link');
         const sections = document.querySelectorAll('.section');

         function showSection(targetId) {
            sections.forEach(section => {
               section.classList.toggle('active', section.id === targetId);
            });
            window.scrollTo(0, 0); // Scroll to top of page on navigation
         }

         navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
               e.preventDefault();
               const targetId = link.getAttribute('href').substring(1);
               showSection(targetId);
               navLinks.forEach(l => l.classList.remove('active-link'));
               link.classList.add('active-link');
            });
         });

         /*=============== IFRAME NAVIGATION ===============*/
         const iframeContainer = document.getElementById('iframe-container');
         const iframeContent = document.getElementById('iframe-content');
         const iframeTitle = document.getElementById('iframe-title');
         const iframeClose = document.getElementById('iframe-close');

         function openInIframe(url, title) {
            iframeTitle.textContent = title || 'Content';
            iframeContent.src = url;
            iframeContainer.style.display = 'flex';
            document.body.style.overflow = 'hidden';
         }

         iframeClose.addEventListener('click', () => {
            iframeContainer.style.display = 'none';
            iframeContent.src = '';
            document.body.style.overflow = '';
         });

         document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && iframeContainer.style.display === 'flex') {
               iframeClose.click();
            }
         });
         
         document.querySelectorAll('.nav__expand-link[data-url]').forEach(link => {
            link.addEventListener('click', (e) => {
               e.preventDefault();
               e.stopPropagation(); 
               openInIframe(link.dataset.url, link.querySelector('span').textContent);
            });
         });

         /*=============== DYNAMIC CONTENT (STORIES, POSTS, PROJECTS) ===============*/
         function setupDynamicContent() {
            // --- STORIES LOGIC ---
            const storiesContainer = document.querySelector(".stories-container");
            if(storiesContainer) {
               const SHEET_URL = "https://docs.google.com/spreadsheets/d/1p63AK6_2JPI1prbQpglHi5spB2f1y2PbcdnsvtS74g8/export?format=csv";
               const storyFull = document.querySelector(".story-full"), storyFullImage = storyFull.querySelector("img"), storyFullTitle = storyFull.querySelector(".title"), learnMoreBtn = storyFull.querySelector(".learn-more-btn"), closeBtn = storyFull.querySelector(".close-btn"), leftArrow = storyFull.querySelector(".left-arrow"), rightArrow = storyFull.querySelector(".right-arrow");
               let storiesData = [], currentIndex = 0, timer, viewedStories = JSON.parse(localStorage.getItem('viewedStories')) || [];
               const loadStories = async () => { try { const r = await fetch(SHEET_URL); if(!r.ok) throw new Error("Network error"); const d = await r.text(); storiesData = d.split('\n').slice(1).map((l,i)=>{const c=l.split(',');return{thumbUrl:c[0]?.trim(),imageUrl:c[1]?.trim(),link:c[2]?.trim(),title:c[3]?.trim()||"Untitled",id:`story-${i}`}}).filter(s=>s.thumbUrl&&s.imageUrl); renderStories(); } catch(e){ console.error("Error loading stories:",e); storiesContainer.innerHTML=`<p style="color:var(--text-secondary);margin:auto;">Could not load stories.</p>`; } };
               const renderStories = () => { storiesContainer.innerHTML=''; storiesData.sort((a,b)=>(viewedStories.includes(a.id)?1:-1)-(viewedStories.includes(b.id)?1:-1)); storiesData.forEach((s,i)=>{const item=document.createElement("div");item.className=`story-item ${viewedStories.includes(s.id)?"viewed":""}`;item.dataset.id=s.id;item.innerHTML=`<div class="content"><img src="${s.thumbUrl}" alt="${s.title}" loading="lazy"></div><div class="story-title">${s.title}</div>`;item.querySelector('.content').addEventListener("click",()=>openStory(i));storiesContainer.appendChild(item);}); };
               const markViewed = id => { if(!viewedStories.includes(id)){ viewedStories.push(id); localStorage.setItem('viewedStories',JSON.stringify(viewedStories)); document.querySelector(`.story-item[data-id="${id}"]`)?.classList.add('viewed'); } };
               const openStory = i => { currentIndex=i; const s=storiesData[i]; storyFull.classList.add("active"); storyFullImage.src=s.imageUrl; storyFullTitle.textContent=s.title; learnMoreBtn.href=s.link||'#'; learnMoreBtn.style.display=s.link?'block':'none'; if(s.link)learnMoreBtn.onclick=e=>{e.preventDefault();openInIframe(s.link,s.title);}; markViewed(s.id); clearInterval(timer); timer=setInterval(nextStory,5000); };
               const closeStory = () => { storyFull.classList.remove("active"); clearInterval(timer); };
               const nextStory = () => currentIndex<storiesData.length-1?openStory(currentIndex+1):closeStory();
               const prevStory = () => currentIndex>0?openStory(currentIndex-1):null;
               closeBtn.addEventListener("click",closeStory); leftArrow.addEventListener("click",prevStory); rightArrow.addEventListener("click",nextStory); document.addEventListener("keydown",e=>{if(!storyFull.classList.contains("active"))return;if(e.key==="ArrowRight")nextStory();if(e.key==="ArrowLeft")prevStory();if(e.key==="Escape")closeStory();});
               loadStories();
            }

            // --- INSTAGRAM POSTS LOGIC ---
            const postsContainer = document.getElementById("instagram-posts");
            if(postsContainer) {
               const SHEET_URL = "https://docs.google.com/spreadsheets/d/1aDM5fGKjmLmYNkkQCW4NuSZsVorj_5ETk9KygVsD0OA/export?format=csv";
               const loadPosts = async () => { try { const r = await fetch(SHEET_URL); if(!r.ok) throw new Error("Network error"); const d = await r.text(); const p = d.split('\n').slice(1).map(l=>{const c=l.split(',');return{imageUrl:c[0]?.trim(),title:c[1]?.trim()||"Untitled",link:c[2]?.trim()||"#" }}).filter(p=>p.imageUrl); renderPosts(p); } catch (e) { console.error("Error loading posts:",e); postsContainer.innerHTML=`<div class="post-error">Failed to load posts.</div>`; }};
               const renderPosts = p => { postsContainer.innerHTML=p.length?'':`<div class="loading-posts">No posts yet.</div>`; p.forEach(post=>{const el=document.createElement("div");el.className="instagram-post";el.innerHTML=`<img src="${post.imageUrl}" class="post-image" alt="${post.title}" loading="lazy"><div class="post-title">${post.title}</div>`;el.querySelector('.post-image').addEventListener('click',()=>{if(post.link&&post.link!=='#')openInIframe(post.link,post.title);});postsContainer.appendChild(el);}); };
               loadPosts();
            }
            
            // --- PROJECTS GRID LOGIC ---
            const projectGrid = document.getElementById('projectGrid');
            if(projectGrid) {
               const CFG = {csvUrl:'https://docs.google.com/spreadsheets/d/13ZV6BXtXKp9aQCKc0OHQoLFCRrif32zvx4khFc4bR9w/export?format=csv',icon:'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4bb.svg'};
               const searchBar=document.getElementById('projectSearchBar'), msgEl=document.getElementById('projectMessage'); let allProjects=[];
               const debounce=(fn,d)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn.apply(this,a),d);};};
               const fetchProjects=async()=>{showMsg(true);try{const r=await fetch(CFG.csvUrl);if(!r.ok)throw new Error('Network error');const d=await r.text();allProjects=d.trim().split('\n').map(l=>{const[n,i,k]=l.split(',').map(p=>p.trim());return{name:n,icon:i||CFG.icon,link:k,search:(n||'').toLowerCase()};}).filter(p=>p.name&&p.link);displayProjects(allProjects);}catch(e){console.error('Error fetching projects:',e);showMsg(false,'Failed to load projects.','error');}finally{if(allProjects.length>0)showMsg(false);}};
               const displayProjects=p=>{projectGrid.innerHTML='';showMsg(false);if(p.length===0){showMsg(true,'No projects match search.','info');return;}p.forEach(proj=>{const card=document.createElement('article');card.className='project-card';card.innerHTML=`<div class="project-icon-container"><img src="${proj.icon}" class="project-icon" alt="" loading="lazy" onerror="this.src='${CFG.icon}'"></div><h3 class="project-name">${proj.name}</h3>`;card.addEventListener('click',()=>openInIframe(proj.link,proj.name));projectGrid.appendChild(card);});};
               const showMsg=(show,text,type='info')=>{msgEl.style.display=show?'flex':'none';if(text){const icons={info:'fas fa-info-circle',error:'fas fa-exclamation-circle'};msgEl.innerHTML=`<i class="${icons[type]} message-icon"></i><p>${text}</p>`;}else{msgEl.innerHTML=`<div class="loading-spinner"></div><p>Loading projects...</p>`;}};
               searchBar.addEventListener('input',debounce(()=>displayProjects(allProjects.filter(p=>p.search.includes(searchBar.value.toLowerCase()))),300));
               fetchProjects();
            }
         }
         
         // --- CONTACT FORM LOGIC ---
         const contactForm = document.getElementById('contact-form');
         if(contactForm) {
            contactForm.addEventListener('submit', function(e) {
               e.preventDefault();
               const data=new FormData(contactForm), statusEl=document.getElementById('form-status');
               const mailto = `mailto:mpcrack65@gmail.com?subject=${encodeURIComponent(data.get('subject'))}&body=${encodeURIComponent(`Name: ${data.get('name')}\nEmail: ${data.get('email')}\n\nMessage:\n${data.get('message')}`)}`;
               try{window.location.href=mailto;statusEl.textContent='Opening your email client...';statusEl.className='success';statusEl.style.display='block';setTimeout(()=>{contactForm.reset();statusEl.style.display='none';},4000);}catch(err){statusEl.textContent='Could not open email client.';statusEl.className='error';statusEl.style.display='block';}
            });
         }
         
         // Initialize all dynamic functionality
         setupDynamicContent();
      });
   </script>
</body>
</html>
